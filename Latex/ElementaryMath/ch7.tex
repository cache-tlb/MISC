\chapter{微积分}

\noindent 橡皮绳上的蚂蚁

有一条橡皮绳, 初始长度为 $L$, 有一只蚂蚁在左端点, 沿着绳子向右端点爬, 速度为 $ V_1 $. 橡皮绳左端点固定, 右端点以速度 $ V_2 $ 被拉长, 绳子各处是均匀拉长的, 并且可以拉到无限长. 问蚂蚁能否爬到右端点, 如果能, 需要多长时间? 一组具体的数值: $ L = 100, V_1=V_2=1 $.

\noindent 解:

设左端点为原点, 时间为 $ t $ 时, 绳子右端点位置为 $ L + V_2 t $, 蚂蚁的位置为 $ s $. 蚂蚁的绝对速度由它的爬行速度和绳子伸长的速度叠加而来, 绳子伸长贡献的速度取决于蚂蚁当前的位置, $ s $ 与 $ t $ 的关系为:
\[
\dv{s}{t} = V_1 + V_2\cdot\frac{s}{L+V_2 t}
\]

这是一个 $ y' + P(x)y = Q(x) $ 形式的常微分方程, 可以直接套公式求. 也可以做如下的代换: $ u = \dfrac{s}{L+V_2t} $, 则 $ s = (L+V_2t)u $, 这里 $ u\in[0,1] $ 表示当前蚂蚁位置相对于绳长的比例. 于是
\begin{align*}
s &= u(L+V_2t) \\
\dd{s} &= (L+V_2t)\dd{u} + V_2u\dd{t} \\
(L+V_2t)\dv{u}{t}+V_2u &=V_1+V_2u \\
\dv{u}{t} &=\frac{V_1}{L+V_2t} \\
u &= \frac{V_1}{V_2}\ln{(L+V_2t)} + C
\end{align*}

当 $ t = 0 $ 时, $ u = 0 $, 所以 $ C = -\dfrac{V_1}{V_2}\ln(L) $. 也就是 $ u = \dfrac{V_1}{V_2}\ln{(1+\dfrac{V_2}{L}t)}$ .

代入数值, 求出 $ u = 1 $ 时的解为 $ t = \left(e^{{V_2}/{V_1}}-1\right)\dfrac{L}{V_2} = 100(e-1)$.


\newpage
%------------------------------------------------------------------------------%
\noindent cubemap 上每个像素对应的立体角

轴对齐的正方体中心位于原点, 边长为 2, 每个面上有一张正方形的纹理, 像素数为 $N\times N$. 相机位于原点. 考虑位于 $z=-1$ 平面上的正方形, $x,y$的范围都是 $[-1,1]$, 其上每个像素虽然面积一样, 但是所占据的视角大小不同, 例如靠近中心的像素对应的视角大于边缘像素对应的视角范围. 用立体角衡量视角的大小, 将面积元投影到以相机为球心的单位球面上, 投影面积就是立体角的大小.
\begin{figure*}[htbp]
\centering
%\tikzset{MyPersp/.style={scale=2,x={(0.95cm,-0.3122cm)}, y={(0cm,1cm)},z={(-0.95cm,-0.3122cm)}}}
%\begin{tikzpicture}[MyPersp,font=\large]
\tdplotsetmaincoords{65}{130}
\begin{tikzpicture}[scale=3.2,tdplot_main_coords]
\shade[ball color = lightgray,opacity = 0.5] (0,0,0) circle (1cm);
\draw[line width=1pt] (0,0,0) circle (1cm);
%\tdplotsphericalsurfaceplot[]{32}{16}{1}{black}{gray!1}{}{}{}%
\foreach \x in {-1,-0.75,...,1}
    \foreach \y in {-1,-0.75,...,1}
    {
        \draw[gray] (-1,\x,-1) -- (-1,\x,1);
        \draw[gray] (-1,-1,\y) -- (-1,1,\y);
    }
\begin{scope}[canvas is zx plane at y=0]
   \draw[dashed] (0,0) circle (1cm);
   \draw[dashed] (-1,0) -- (0,0);
\end{scope}
\begin{scope}[canvas is xy plane at z=0]
   \draw[dashed] (0,0) circle (1cm);
  \draw[dashed] (0,-1) -- (0,0);
\end{scope}
\begin{scope}[canvas is zy plane at x=0]
%  \draw (0,0) circle (1cm);
%  \draw (-1,0) -- (1,0) (0,-1) -- (0,1);
\end{scope}
\coordinate (O) at (0,0,0);
\draw[->,line width=1pt] (O)--(1.75,0,0)node[left,fill opacity=1,black]{$z$};	% old x
\draw[->,line width=1pt] (O)--(0,1.75,0)node[right,fill opacity=1,black]{$x$}; % old y
\draw[->,line width=1pt] (O)--(0,0,1.75)node[above,fill opacity=1,black]{$y$}; % old z
\draw[dashed,line width=1pt] (O)--(-1,0,0);
\fill[fill=black,draw=black,thick,fill opacity=1] (-1,0,0) circle (0.6pt);
\fill[fill=black,draw=black,thick,fill opacity=1] (0,0,0) circle (0.6pt);
\coordinate (P) at (-1,0.9,0.1);
\coordinate (Q) at (-0.6,0.9,0.1);
\fill[fill=black,draw=black,thick,fill opacity=1] (P) circle (0.6pt);
\draw[dashed,red,line width=1pt] (O) -- (P)node[above,fill opacity=1,black]{$P=(x,y,-1)$};
\draw[->,blue,line width=1pt] (P)--(Q)node[below right,fill opacity=1,blue]{$\vec{n}$};
\draw pic[draw,line width=1pt, angle eccentricity=1.8, angle radius=0.5cm] {angle=O--P--Q};
\end{tikzpicture}
\end{figure*}

设原点为 $O$, 考虑正方形上的一点 $P=(x,y,1)$, 
$P$处的面积微元为 $\mathrm{d}A = \mathrm{d}x\cdot\mathrm{d}y$, 法线方向为 $\vec{n} = (0,0,1)$, 
$P$点到原点的距离为 $R = |OP| = \sqrt{x^2+y^2+1}$, $\vec{PO}$ 方向的单位向量为 $\vec{p} = \dfrac{(x,y,1)}{R}$, 
$\mathrm{d}A$ 在 $\vec{PO}$ 方向上的投影面积为 $\mathrm{d}A\cdot\cos\angle(\vec{n},\vec{p})$, 该投影面积对应的球半径为 $R$, 所以对于 $x\in[x_1,x_2], y\in[y_1,y_2]$的一块矩形区域对应立体角为:
\[
sr_{[x_1,x_2]\times[y_1,y_2]} = \int_A\frac{(\vec{n}\cdot\vec{p})}{R^2} \ \mathrm{d}A = \int_A\frac{1}{R^3} \ \mathrm{d}A = \int_{y_1}^{y_2}{\int_{x_1}^{x_2}\frac{1}{(x^2+y^2+1)^{\frac{3}{2}}}\ \mathrm{d}x}\ \mathrm{d}y \ .
\]
先计算 
\[f(s,t) = sr_{[0,s]\times[0,t]} = \int_0^t{\int_0^s\frac{1}{(x^2+y^2+1)^{\frac{3}{2}}}\ \mathrm{d}x}\ \mathrm{d}y\ , \]
令 $u = \dfrac{x}{\sqrt{x^2+y^2+1}}$, 则积分上下限分别是 $x=0\rightarrow u=0$; $x=s\rightarrow u=\dfrac{s}{s^2+y^2+1}$, 
\[\dfrac{\mathrm{d}u}{\mathrm{d}x} = \dfrac{y^2+1}{(x^2+y^2+1)^\frac{3}{2}} ,\] 
积分换元得:
\begin{align*}
f(s,t) &= \int_0^t{\int_0^{\frac{s}{\sqrt{s^2+y^2+1}}}{\frac{1}{1+y^2}}\ \mathrm{d}u}\ \mathrm{d}y\\
&=\int_0^t{\frac{s}{(y^2+1)\sqrt{y^2+s^2+1}}}\ \mathrm{d}y . 
\end{align*}

继续换元, 令 $v = \dfrac{y}{\sqrt{y^2+s^2+1}} $, 则积分上下限为 $y=0\rightarrow v=0$; $y=t\rightarrow v=\dfrac{t}{\sqrt{s^2+t^2+1}}$, 以及
\[\frac{\mathrm{d}v}{\mathrm{d}y} = \frac{s^2+1}{(y^2+s^2+1)^\frac{3}{2}} ,\qquad y^2 + 1 = \frac{v^2s^2+1}{1-v^2} ,\qquad 1-v^2=\frac{s^2+1}{y^2+s^2+1} .\]
于是
\begin{align*}
f(s,t) &= \int_0^\frac{t}{\sqrt{s^2+t^2+1}} {\frac{s(1-v^2)}{v^2s^2+1}\cdot\frac{y^2+s^2+1}{s^2+1}}\ \mathrm{d}v \\ 
&= \int_0^\frac{t}{\sqrt{s^2+t^2+1}}{\frac{s}{s^2v^2+1}}\ \mathrm{d}v\\
&= \int_0^\frac{t}{\sqrt{s^2+t^2+1}}{\frac{1}{s}\cdot\frac{1}{v^2+\dfrac{1}{s^2}}}\ \mathrm{d}v\\
&= \frac{1}{s}\cdot s\arctan(sv)\bigg|_{v=0}^{v=\frac{t}{\sqrt{s^2+t^2+1}}}\\
&= \arctan(\frac{st}{\sqrt{s^2+t^2+1}}) .
\end{align*}

得到 $f(s,t)$ 的表达式之后, 可以用下面的方法计算其他范围的立体角:
\[sr_{[x_1,x_2]\times[y_1,y_2]} = f(x_2,y_2) - f(x_1,y_2) - f(x_2,y_1) + f(x_1,y_1) .\]

作为验证, 考虑 cubemap 的一个面, 占据了 $\dfrac{1}{6}$ 个球面, 对应的立体角应该是 $\dfrac{2\pi}{3}$. 而
\begin{align*}
sr_{[-1,1]\times[-1,1]} &= f(1,1) - f(-1,1) - f(1,-1) + f(1,1) \\
& = 4\times f(1,1) \\
&= 4\times \arctan(\dfrac{1}{\sqrt{3}}) \\
& = \dfrac{2\pi}{3} .
\end{align*} 

\newpage
%------------------------------------------------------------------------------%
















